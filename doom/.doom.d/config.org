#+TITLE: Doom Emacs Configuration
#+AUTHOR: Lucas Cunegundes
#+EMAIL: lucascsantana6@gmail.com
#+DESCRIPTION: Configuração pessoal do Doom Emacs focada em Python/Django
#+STARTUP: fold
#+PROPERTY: header-args:emacs-lisp :tangle config.el :cache yes :results silent :padline no

* Table of Contents :TOC_3:noexport:
- [[#informações-pessoais][Informações Pessoais]]
- [[#aparência][Aparência]]
  - [[#fonte][Fonte]]
  - [[#tema-e-ui][Tema e UI]]
- [[#org-mode][Org Mode]]
- [[#python-development][Python Development]]
  - [[#lsp-eglot--basedpyright][LSP (Eglot + BasedPyright)]]
    - [[#configuração-base][Configuração Base]]
    - [[#basedpyright-settings][BasedPyright Settings]]
  - [[#diagnósticos-flymake][Diagnósticos (Flymake)]]
  - [[#formatação-apheleia--ruff][Formatação (Apheleia + Ruff)]]
  - [[#debug-dape][Debug (Dape)]]
- [[#keybindings][Keybindings]]
- [[#database-ejc-sql][Database (EJC-SQL)]]
- [[#terminal-vterm][Terminal (VTerm)]]

* Informações Pessoais
Configuração básica de identidade.

#+begin_src emacs-lisp
(setq user-full-name "Lucas Cunegundes"
      user-mail-address "lucascsantana6@gmail.com")
#+end_src

* Aparência

** Fonte
Iosevka Nerd Font Mono, tamanho 12.

#+begin_src emacs-lisp
(setq doom-font (font-spec :family "Iosevka Nerd Font Mono" :size 12))

(custom-set-faces!
  '(italic :slant italic)
  '(bold :weight bold)
  '(bold-italic :weight bold :slant italic))
#+end_src

** Tema e UI
Tokyo Night com números de linha relativos e beacon mode para tracking visual do cursor.

#+begin_src emacs-lisp
(setq doom-theme 'doom-tokyo-night
      display-line-numbers-type 'relative)

(beacon-mode 1)
#+end_src

* Org Mode
Configuração para organização pessoal, agenda e produtividade.

#+begin_src emacs-lisp
(use-package! org
  :config
  (setq org-directory "~/Documentos/"
        org-agenda-files '("~/Documentos/agenda.org")
        org-log-done 'time)
  (add-hook 'org-mode-hook #'org-bullets-mode))
#+end_src

* Python Development
Configuração completa para desenvolvimento Python com foco em Django + Docker.

** LSP (Eglot + BasedPyright)
Language Server Protocol com BasedPyright otimizado para projetos Django.

*** Configuração Base
Habilita Eglot automaticamente e define virtualenv padrão.

#+begin_src emacs-lisp
(after! python
  (setq python-shell-virtualenv-root ".venv")
  (add-hook 'python-mode-hook #'eglot-ensure)
  (add-hook 'python-ts-mode-hook #'eglot-ensure))
#+end_src

*** BasedPyright Settings
Type checking desligado para reduzir noise em projetos Django. Mantém autocomplete e navegação.

#+begin_src emacs-lisp
(after! eglot
  (setq eglot-autoshutdown t
        eglot-sync-connect nil
        eglot-extend-to-xref t
        eglot-report-progress nil
        eglot-events-buffer-size 0)
  
  ;; BasedPyright como LSP server
  (add-to-list 'eglot-server-programs
               '((python-mode python-ts-mode)
                 . ("basedpyright-langserver" "--stdio")))
  
  ;; Workspace configuration - Django optimized
  (defun +python-eglot-workspace-config ()
    "Configuração BasedPyright otimizada para Django/Docker."
    (when (projectile-project-root)
      `(:basedpyright
        (:analysis
         (:typeCheckingMode "off"
          :diagnosticMode "openFilesOnly"
          :autoImportCompletions t
          :autoSearchPaths t
          :useLibraryCodeForTypes nil
          :extraPaths ["."]
          :diagnosticSeverityOverrides
          (:reportUnknownMemberType "none"
           :reportUnknownVariableType "none"
           :reportUnknownArgumentType "none"
           :reportUnknownParameterType "none"
           :reportMissingTypeStubs "none"
           :reportGeneralTypeIssues "none"
           :reportOptionalMemberAccess "none"
           :reportOptionalSubscript "none"
           :reportPrivateImportUsage "none"
           :reportAttributeAccessIssue "none"
           :reportIncompatibleMethodOverride "none"))))))
  
  (add-hook 'python-mode-hook
            (lambda ()
              (setq-local eglot-workspace-configuration
                          (+python-eglot-workspace-config))))
  
  ;; Remove símbolos ! inline
  (add-hook 'eglot-managed-mode-hook
            (lambda ()
              (setq-local eldoc-documentation-strategy
                          'eldoc-documentation-compose-eagerly))))
#+end_src

** Diagnósticos (Flymake)
Interface visual limpa com diagnósticos apenas na fringe direita.

#+begin_src emacs-lisp
(after! flymake
  ;; Configuração visual
  (setq flymake-show-diagnostics-at-end-of-line nil
        flymake-indicator-type 'fringe
        flymake-fringe-indicator-position 'right-fringe
        flymake-no-changes-timeout 0.5
        flymake-start-on-save-buffer t)
  
  ;; Remove todos os underlines
  (set-face-attribute 'flymake-error nil :underline nil)
  (set-face-attribute 'flymake-warning nil :underline nil)
  (set-face-attribute 'flymake-note nil :underline nil)
  
  ;; Bitmaps minimalistas para a fringe
  (define-fringe-bitmap 'flymake-error-bitmap
    [#b00000000
     #b00011000
     #b00011000
     #b00000000] nil nil 'center)
  
  (define-fringe-bitmap 'flymake-warning-bitmap
    [#b00000000
     #b00011000
     #b00011000
     #b00000000] nil nil 'center))
#+end_src

** Formatação (Apheleia + Ruff)
Auto-formatação on-save com Ruff (format + isort).

#+begin_src emacs-lisp
(use-package! apheleia
  :hook ((python-mode python-ts-mode) . apheleia-mode)
  :config
  ;; Usa Ruff como formatador padrão
  (setf (alist-get 'python-mode apheleia-mode-alist) '(ruff-isort ruff))
  (setf (alist-get 'python-ts-mode apheleia-mode-alist) '(ruff-isort ruff))
  
  ;; Configuração dos formatadores
  (setf (alist-get 'ruff apheleia-formatters)
        '("ruff" "format" "--stdin-filename" filepath))
  (setf (alist-get 'ruff-isort apheleia-formatters)
        '("ruff" "check" "--select" "I" "--fix" "--stdin-filename" filepath)))
#+end_src

** Debug (Dape)
Debugger para Python em containers Docker com mapeamento de paths.

#+begin_src emacs-lisp
(use-package! dape
  :config
  (setq dape-buffer-window-arrangement 'right
        dape-info-hide-mode-line t)

  ;; Config genérica para qualquer projeto Docker
  (add-to-list
   'dape-configs
   `(python-docker
     modes (python-mode python-ts-mode)
     command "python"
     command-args ("-m" "debugpy.adapter")
     port 5678
     host "127.0.0.1"
     cwd ,(lambda () (or (projectile-project-root) default-directory))
     path-mappings
     (,(lambda ()
         (list
          (cons
           (or (projectile-project-root) default-directory)
           "/app"))))))

  ;; Config específica - Projeto Aliança
  (add-to-list
   'dape-configs
   `(python-docker-alianca
     modes (python-mode python-ts-mode)
     command "python"
     command-args ("-m" "debugpy.adapter")
     port 5678
     host "127.0.0.1"
     cwd "/home/lucas/Projects/work/alianca/apps/backend/"
     path-mappings
     (("/home/lucas/Projects/work/alianca/apps/backend/" . "/app")))))
#+end_src

* Keybindings
Atalhos customizados seguindo convenções do Doom Emacs.

#+begin_src emacs-lisp
(map! :leader
      ;; Code actions
      (:prefix ("c" . "code")
       :desc "Code actions"        "a" #'eglot-code-actions
       :desc "Rename symbol"       "r" #'eglot-rename
       :desc "Format buffer"       "f" #'apheleia-format-buffer
       :desc "Hover doc"           "k" #'eldoc-doc-buffer)
      
      ;; Navigation
      (:prefix ("g" . "goto")
       :desc "Definition"          "d" #'xref-find-definitions
       :desc "References"          "r" #'xref-find-references
       :desc "Implementations"     "i" #'eglot-find-implementation)
      
      ;; Diagnostics
      (:prefix ("e" . "errors")
       :desc "Next diagnostic"     "n" #'flymake-goto-next-error
       :desc "Prev diagnostic"     "p" #'flymake-goto-prev-error
       :desc "Buffer diagnostics"  "l" #'flymake-show-buffer-diagnostics
       :desc "Project diagnostics" "L" #'flymake-show-project-diagnostics))
#+end_src

* Database (EJC-SQL)
Cliente SQL interativo para PostgreSQL com completion e syntax highlighting.

#+begin_src emacs-lisp
(use-package! ejc-sql
  :commands (ejc-sql-mode ejc-sql-connect)
  :config
  (setq ejc-sql-separator ";"
        ejc-use-flx t
        ejc-result-table-impl 'ejc-result-table-tabulated))

(after! ejc-sql
  ;; Conexão - Projeto Nexus
  (ejc-create-connection
   "postgres-nexus"
   :classpath (ejc-find-postgres-jdbc)
   :dbtype "postgresql"
   :dbname "nexus_rfid"
   :host "localhost"
   :port 5432
   :user "postgres")

  ;; Conexão - Projeto Aliança
  (ejc-create-connection
   "postgres-alianca"
   :classpath (ejc-find-postgres-jdbc)
   :dbtype "postgresql"
   :dbname "alianca_rfid"
   :host "localhost"
   :port 5432
   :user "postgres"))
#+end_src

* Terminal (VTerm)
Terminal emulado usando ZSH como shell padrão.

#+begin_src emacs-lisp
(use-package! vterm
  :commands vterm
  :config
  (setq vterm-shell "/bin/zsh"))
#+end_src
